<?xml version="1.0"?>

<system name="lightning">

    <property value="0">systems/lightning/light-uv-instrument</property>
    <property value="0">systems/lightning/light-uv-instrument-bright</property>
    <property value="0">systems/lightning/light-uv-instrument-bright-pos</property>
    <property value="0">systems/lightning/light-red-emer-instrument</property>
    <property value="0">systems/lightning/light-red-emer-instrument-bright</property>
    <property value="0">systems/lightning/light-red-emer-instrument-bright-pos</property>
    <property value="0">systems/lightning/light-red-console</property>
    <property value="0">systems/lightning/light-red-console-bright</property>
    <property value="0">systems/lightning/light-red-console-bright-pos</property>
    <property value="0">systems/lightning/light-panel</property>
    <property value="0">systems/lightning/intensity-bus1-norm</property>
    <property value="0">systems/lightning/intensity-bus2-norm</property>
    <property value="0">systems/lightning/ambient-light-emission-display-correction</property>
    <property value="0">systems/lightning/landing-light/intensity-norm</property>
    <property value="0">systems/lightning/landing-light/on</property>
    <property value="0">systems/lightning/taxiing-light/intensity-norm</property>
    <property value="0">systems/lightning/taxiing-light/on</property>
    <property value="0">systems/lightning/beacon/on</property>
    <property value="0">systems/lightning/beacon/motor</property>
    
    
    <channel name="light uv instrument" execrate="32">
        
        <lag_filter name="systems/lightning/light-uv-instrument-bright-pos">
            <input>systems/lightning/light-uv-instrument-bright</input>
            <c1>4.0</c1>
        </lag_filter>
        
        <switch name="systems/lightning/light-uv-instrument-on">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[1]/instrument-flood-lights/fuse == 1
                systems/lightning/light-uv-instrument-bright-pos GT 0.1
            </test>
        </switch>
        
        <pure_gain name="systems/lightning/light-uv-instrument-on-volt-norm">
            <gain>systems/lightning/light-uv-instrument-on</gain>
            <input>systems/lightning/intensity-bus1-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/lightning/light-uv-instrument">
            <gain>systems/lightning/light-uv-instrument-bright-pos</gain>
            <input>systems/lightning/light-uv-instrument-on-volt-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/electric/bus[1]/instrument-flood-lights/I">
            <gain>3.0</gain>
            <input>systems/lightning/light-uv-instrument-on-volt-norm</input>
        </pure_gain>
        
    </channel>
    
    
    <channel name="instrument panel emerg lights" execrate="32">
        
        <lag_filter name="systems/lightning/light-red-emer-instrument-bright-pos">
            <input>systems/lightning/light-red-emer-instrument-bright</input>
            <c1>4.0</c1>
        </lag_filter>
        
        <switch name="systems/lightning/light-red-emer-instrument-on">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[1]/instrument-panel-emerg-lights/fuse == 1
                systems/lightning/light-red-emer-instrument-bright-pos GT 0.1
            </test>
        </switch>
        
        <pure_gain name="systems/lightning/light-red-emer-instrument-on-volt-norm">
            <gain>systems/lightning/light-red-emer-instrument-on</gain>
            <input>systems/lightning/intensity-bus1-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/lightning/light-red-emer-instrument">
            <gain>systems/lightning/light-red-emer-instrument-bright-pos</gain>
            <input>systems/lightning/light-red-emer-instrument-on-volt-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/electric/bus[1]/instrument-panel-emerg-lights/I">
            <gain>1.0</gain>
            <input>systems/lightning/light-red-emer-instrument-on-volt-norm</input>
        </pure_gain>
        
    </channel>

    
    
    <channel name="light red console and panel" execrate="32">
        
        <lag_filter name="systems/lightning/light-red-console-bright-pos">
            <input>systems/lightning/light-red-console-bright</input>
            <c1>4.0</c1>
        </lag_filter>
        
        <switch name="systems/lightning/light-red-console-on">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[1]/console-lights/fuse == 1
                systems/lightning/light-red-console-bright-pos GT 0.1
            </test>
        </switch>
        
        <pure_gain name="systems/lightning/light-red-console-on-volt-norm">
            <gain>systems/lightning/light-red-console-on</gain>
            <input>systems/lightning/intensity-bus1-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/lightning/light-red-console">
            <gain>systems/lightning/light-red-console-bright-pos</gain>
            <input>systems/lightning/light-red-console-on-volt-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/electric/bus[1]/console-lights/I">
            <gain>1.5</gain>
            <input>systems/lightning/light-red-console-on-volt-norm</input>
        </pure_gain>
        
        <switch name="systems/lightning/light-panel-on">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[2]/panel-lights/fuse == 1
                systems/lightning/light-red-console-bright-pos GT 0.1
            </test>
        </switch>
        
        <pure_gain name="systems/lightning/light-panel-on-volt-norm">
            <gain>systems/lightning/light-panel-on</gain>
            <input>systems/lightning/intensity-bus2-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/lightning/light-panel">
            <gain>systems/lightning/light-red-console-bright-pos</gain>
            <input>systems/lightning/light-panel-on-volt-norm</input>
        </pure_gain>
        
        <pure_gain name="systems/electric/bus[2]/panel-lights/I">
            <gain>1.5</gain>
            <input>systems/lightning/light-panel-on-volt-norm</input>
        </pure_gain>
        
    </channel>
    
    
    <channel name="landing light" execrate="32">
        
        <lag_filter name="systems/lightning/landing-light/intensity-norm">
            <input>systems/lightning/landing-light/on</input>
            <c1>16.0</c1>
        </lag_filter>
        
        <lag_filter name="systems/lightning/taxiing-light/intensity-norm">
            <input>systems/lightning/taxiing-light/on</input>
            <c1>16.0</c1>
        </lag_filter>
    
        <switch name="systems/lightning/landing-light/on">
            <default value="0"/>
            <test logic="OR" value="systems/lightning/intensity-bus1-norm">
                <test logic="AND">
                    systems/manual-switches/cockpit/sw-landing-light GT 0.95
                    systems/electric/bus[1]/landing-light/fuse == 1
                    gear/unit/compression-ft LE 0.0001
                    gear/gear-pos-norm GT 0
                </test>
                <test logic="AND">
                    systems/manual-switches/cockpit/sw-landing-light-test == 1
                    systems/electric/bus[1]/landing-light/fuse == 1
                </test>
            </test>
        </switch>
        
        <switch name="systems/lightning/taxiing-light/on">
            <default value="0"/>
            <test logic="AND" value="systems/lightning/intensity-bus1-norm">
                systems/manual-switches/cockpit/sw-landing-light GT 0.95
                systems/electric/bus[1]/landing-light/fuse == 1
                gear/unit/compression-ft GT 0.0001
                gear/gear-pos-norm GT 0
            </test>
        </switch>
        
        <summer name="systems/electric/bus[1]/landing-light/I">
            <input>systems/lightning/landing-light/I</input>
            <input>systems/lightning/taxiing-light/I</input>
        </summer>

        <pure_gain name="systems/lightning/landing-light/I">
            <input>systems/lightning/landing-light/on</input>
            <gain>16.0</gain>
        </pure_gain>
        
        <pure_gain name="systems/lightning/taxiing-light/I">
            <input>systems/lightning/taxiing-light/on</input>
            <gain>2.15</gain>
        </pure_gain>
        
    </channel>

    <channel name="beacon light" execrate="32">

        <switch name="systems/lightning/beacon/on">
            <default value="0"/>
            <test logic="AND" value="systems/lightning/intensity-bus1-norm">
                systems/manual-switches/lateral_panel_right/lightning/sw-flasher-on == 1
                systems/electric/bus[1]/beacon-light/fuse == 1
            </test>
        </switch>
        
        <lag_filter name="systems/lightning/beacon/motor">
            <input>systems/lightning/beacon/on</input>
            <c1>2.0</c1>
        </lag_filter>
        
        <pure_gain name="systems/electric/bus[1]/beacon/I">
            <input>systems/lightning/beacon/on</input>
            <gain>3.0</gain>
        </pure_gain>

    </channel>
    
    <channel name="position lights" execrate="32">

        
        <switch name="systems/lightning/anticollision/on">
            <default value="0"/>
            <test logic="AND" value="systems/lightning/intensity-bus1-norm">
                systems/manual-switches/lateral_panel_right/lightning/sw-anticollision-on == 1
                systems/electric/bus[1]/anti-collision-light/fuse == 1
            </test>
        </switch>
        
        <pure_gain name="systems/electric/bus[1]/anticollision/I">
            <input>systems/lightning/anticollision/on</input>
            <gain>3.0</gain>
        </pure_gain>
        
        

    </channel>
    
    <channel name="ambient lighting corection" execrate="64">

        <fcs_function name="systems/lightning/ambient-light-emission-display-correction">
            <function>
                <interpolate1d>
                    <p>/rendering/scene/ambient/blue</p>
                    <v> 0.0 </v>  <v> 0.3 </v>
                    <v> 0.2 </v>  <v> 0.35 </v>
                    <v> 0.4 </v>  <v> 0.4 </v>
                    <v> 0.6 </v>  <v> 0.6 </v>
                    <v> 0.8 </v>  <v> 0.9 </v>
                    <v> 1.0 </v>  <v> 1.0 </v>
                </interpolate1d>
            </function>
        </fcs_function>

    </channel>

    <function name="systems/lightning/intensity-bus1-norm">
        <table>
            <independentVar>systems/electric/bus[1]/V</independentVar>
            <tableData>
                0.0   0.0
                10.0  0.3
                20.0  0.5
                30.0  1.0
            </tableData>
        </table>
    </function>
    
    <function name="systems/lightning/intensity-bus2-norm">
        <table>
            <independentVar>systems/electric/bus[2]/V</independentVar>
            <tableData>
                0.0   0.0
                10.0  0.3
                20.0  0.5
                30.0  1.0
            </tableData>
        </table>
    </function>
    
</system>

