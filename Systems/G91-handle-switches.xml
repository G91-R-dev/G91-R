<?xml version="1.0"?>

<!-- 
Original work Copyright (c) 2019 Adriano Bassignana (abassign)
    Create the program handle switches integration
Modified work Copyright 2019 Joshua Davidson (it0uchpods)
    Modify the "handle brake" channel
-->

<system name="Manual handle switches"> 
    
    <property value="0.0">systems/handle-switches/sw-handle-brake-trigger</property>
    <property value="0.0">systems/handle-switches/sw-handle-brake-trigger-fcs-wa</property>
    <property value="0.0">systems/handle-switches/sw-handle-brake-move</property>
    <property value="0.0">systems/handle-switches/sw-handle-brake-pos-rotate</property>
    <property value="0.0">systems/handle-switches/sw-handle-brake-extension</property>
    
    <channel name="handle brake" execrate="16">
        
        <washout_filter name="systems/handle-switches/sw-handle-brake-trigger-fcs-wa">
            <input>/controls/gear/brake-parking</input>
            <c1>4.0</c1>
        </washout_filter>
        
        <switch name="systems/handle-switches/sw-handle-brake-move">
            <default value="0"/>
            <test logic="OR" value="1">
                systems/handle-switches/sw-handle-brake-trigger-fcs-wa GT 0.5
                systems/handle-switches/sw-handle-brake-trigger-fcs-wa LT -0.5
                systems/handle-switches/sw-handle-brake-trigger == 1
            </test>
        </switch>
        
        <switch name="systems/handle-switches/sw-handle-brake-pos-status">
            <default value="systems/handle-switches/sw-handle-brake-pos-status"/>
            <test logic="AND" value="0">
                gear/unit[0]/wheel-speed-fps GT 0.5
                systems/handle-switches/sw-handle-brake-move == 0
            </test>
            <test logic="AND" value="1">
                gear/unit[0]/wheel-speed-fps GT 0.5
                systems/handle-switches/sw-handle-brake-move == 1
            </test>
            <test logic="AND" value="0">
                gear/unit[0]/wheel-speed-fps LE 0.5
                systems/handle-switches/sw-handle-brake-move == 1
                systems/handle-switches/sw-handle-brake-pos-rotate GT 0.95
            </test>
            <test logic="AND" value="2">
                gear/unit[0]/wheel-speed-fps LE 0.5
                systems/handle-switches/sw-handle-brake-move == 1
            </test>
        </switch>
        
        <switch name="systems/handle-switches/sw-handle-brake-pos-status-linear">
            <default value="systems/handle-switches/sw-handle-brake-pos-status-linear"/>
            <test logic="AND" value="1">
                systems/handle-switches/sw-handle-brake-pos-status GE 1
            </test>
            <test logic="AND" value="0">
                systems/handle-switches/sw-handle-brake-pos-status == 0
                systems/handle-switches/sw-handle-brake-pos-rotate LE 0.1
            </test>
        </switch>
        
    </channel>
        
    <channel name="handle brake extension handle" execrate="4">
        <lag_filter name="systems/handle-switches/sw-handle-brake-extension">
            <input>systems/handle-switches/sw-handle-brake-pos-status-linear</input>
            <c1>1.5</c1>
        </lag_filter>
        
        <lag_filter name="systems/handle-switches/sw-handle-brake-pos-rotate">
            <input>systems/handle-switches/sw-handle-brake-pos-status-rotate</input>
            <c1>3.0</c1>
        </lag_filter>
        
        <switch name="systems/handle-switches/sw-handle-brake-pos-status-rotate">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/handle-switches/sw-handle-brake-pos-status == 2
                systems/handle-switches/sw-handle-brake-extension GT 0.9
            </test>
            <test logic="AND" value="0">
                systems/handle-switches/sw-handle-brake-pos-status LE 1
            </test>
        </switch>
        
    </channel>
    
</system>
