<?xml version="1.0"?>

<system name="Airbrake">
    
    <!-- per avere l'effetto di limitazione ed allugamento del tempo
    fare un integratore con serbatoio di accumulo in funzione della pressione
    dell'impianto idraulico. In questo modo si ottiene la limitazione dello sforzo, ma anche 
    il rallentamento -->
    
    <property value="1.94">systems/airbrake/surfice-cmd-sqft</property>
    <property value="0.8">systems/airbrake/cd_coefficient</property>
    <property value="1.0">systems/airbrake/position_max</property>
    <property value="4.0">systems/airbrake/jack-section</property>
    <property value="10.0">systems/airbrake/jack-stroke</property>
    
    <channel name="Airbrake control">
        
        <kinematic name="airbrake Control">
            <input>fcs/speedbrake-cmd-norm</input>
            <noscale/>
            <traverse>
                <setting>
                    <position> 0 </position>
                    <time>     0 </time>
                </setting>
                <setting>
                    <position> 1 </position>
                    <time>     3 </time>
                </setting>
            </traverse>
            <output>fcs/speedbrake-pos-norm</output>
        </kinematic>
        
        <summer>
            <input>fcs/speedbrake-pos-norm</input>
            <input>systems/airbrake/hydraulics_flux</input>
            <output>systems/airbrake/hydraulics_vol</output>
        </summer>
        
        <integrator>
            <c1> 0.1 </c1>
            <input>systems/airbrake/hydraulics_vol</input>
            <output>systems/airbrake/hydraulics_flux</output>
        </integrator>
        <!--
        <switch name="systems/airbrake/switch_hydraulics_flux">
            <default value="0.0"/>
            <test logic="AND" value="1">
                fcs/speedbrake-cmd-norm GT 0
                systems/airbrake/position LT 1
            </test>
            <test logic="AND" value="-1">
                fcs/speedbrake-cmd-norm == 0
                systems/airbrake/position GT 0
            </test>
        </switch>
        -->
        <!--
        <pure_gain name="systems/airbrake/hydraulics_flux">
            <input>systems/hydraulics/flight-system-psi</input>
            <gain>systems/airbrake/switch_hydraulics_flux</gain>
        </pure_gain>
        -->
        <integrator name="systems/airbrake/position">
            <input>systems/airbrake/hydraulics_flux</input>
            <c1> 0.03 </c1>
            <clipto>
                <min> 0.0 </min>
                <max>systems/airbrake/position_max</max>
            </clipto>
        </integrator>
        
        <pure_gain>
            <input>systems/airbrake/surfice-cmd-sqft</input>
            <gain>aero/qbar-psf</gain>
            <output>external_reactions/Airbrake/magnitude</output>
        </pure_gain>
        
        <pure_gain>
            <input>systems/airbrake/location-z-in</input>
            <gain>-1.0</gain>
            <output>external_reactions/Airbrake/location-z-in</output>
        </pure_gain>
        
    </channel>
    
    <function name="systems/airbrake/surfice-cmd-sqft">
        <table>
            <independentVar>fcs/speedbrake-pos-norm</independentVar>
            <tableData>
                0 0.00
                0.125 0.56
                0.25 1.12
                0.375 1.67
                0.5 2.2
                0.625 2.72
                0.75 3.22
                0.875 3.7
                1 4.14
            </tableData>
        </table>
    </function>
    
    <function name="systems/airbrake/location-z-in">
        <table>
            <independentVar>fcs/speedbrake-pos-norm</independentVar>
            <tableData>
                0 19.7
                0.125 21.2
                0.25 22.8
                0.375 24.3
                0.5 25.7
                0.625 27.2
                0.75 28.5
                0.875 29.8
                1 31.1
            </tableData>
        </table>
    </function>
    
</system>

