<?xml version="1.0"?>

<!--
Description: G91R2 Canopy automation
-->

<system name="starter">
    
    <property value="0">systems/starter/sw-cover-trigger</property>
    <property value="0">systems/starter/sw-cover-pos</property>
    <property value="0">systems/starter/sw-push-togle</property>
    <property value="0">systems/starter/sw-push-pos</property>
    
    
    <channel name="starter switch" execrate="8">
        
        <lag_filter name="systems/starter/sw-cover-pos">
            <input>systems/starter/sw-cover-togle-on</input>
            <c1>8.0</c1>
        </lag_filter>
        
        <switch name="systems/starter/sw-cover-togle-on">
            <!--
                "systems/starter/sw-cover-pos LE 0.1" is condition for anti-bounce button in opening phase
                "systems/starter/sw-cover-pos GE 0.9" is condition for anti-bounce button in closing phase
            -->
            <default value="systems/starter/sw-cover-togle-on"/>
            <test logic="AND" value = "1">
                systems/starter/sw-cover-trigger == 1
                systems/starter/sw-cover-togle-on == 0
                systems/starter/sw-cover-pos LE 0.1
            </test>
            <test logic="AND" value = "0">
                systems/starter/sw-cover-trigger == 1
                systems/starter/sw-cover-togle-on == 1
                systems/starter/sw-cover-pos GE 0.9
            </test>
            <test logic="OR" value = "0">
                <test logic="AND">
                    systems/starter/sw-push-togle-washed GE 0.1
                    systems/starter/sw-push-togle-washed LE 0.2
                </test>
                <test logic="AND">
                    systems/starter/sw-push-togle-washed LE -0.1
                    systems/starter/sw-push-togle-washed GE -0.2
                </test>
            </test>
        </switch>
        
        <!-- Starter pusher -->
        
        <washout_filter name="systems/starter/sw-push-togle-washed">
            <input>systems/starter/sw-push-togle</input>
            <c1>1.0</c1>
        </washout_filter>
        
        <switch name="systems/starter/sw-push-togle-norm">
            <default value="1"/>
            <test logic="AND" value = "0">
                systems/starter/sw-push-togle-washed LT 0.6
                systems/starter/sw-push-togle-washed GT -0.6
            </test>
        </switch>
        
        <switch name="systems/starter/sw-push-trigger">
            <default value="systems/starter/sw-push-trigger"/>
            <test logic="AND" value="1">
                systems/starter/sw-push-togle-norm == 1
                systems/starter/sw-push-pos LE 0.05
                systems/starter/sw-push-trigger == 0
            </test>
            <test logic="AND" value="0">
                systems/starter/sw-push-pos GT 0.95
            </test>
        </switch>
        
        <lag_filter name="systems/starter/sw-push-pos">
            <input>systems/starter/sw-push-trigger</input>
            <c1>4.0</c1>
        </lag_filter>
        
        <switch name="systems/starter/sw-push">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/starter/sw-push-trigger == 1
                systems/starter/sw-push-pos GT 0.50
            </test>
            <test logic="AND" value="0">
                systems/starter/sw-push-trigger == 0
                systems/starter/sw-push-pos LE 0.50
            </test>
        </switch>
        
        <!-- Starter rele deleyed -->
        
        <switch name="systems/starter/sw-push-trigger-rele">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/starter/electric-ok == 1
                systems/starter/sw-push-trigger == 1
            </test>
        </switch>
        
        <lag_filter name="systems/starter/sw-push-rele-deleyed">
            <input>systems/starter/sw-push-trigger-rele</input>
            <c1>0.03</c1>
        </lag_filter>
        
        <switch name="systems/starter/sw-push-rele-deleyed-on">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/starter/sw-push-rele-deleyed GT 0.008
            </test>
        </switch>
        
    </channel>
    
    
    <channel name="starter electric" execrate="16">
        
        <switch name="systems/starter/electric-ok">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[1]/V GT 18.0
            </test>
        </switch>
        
        <switch name="systems/electric/bus[1]/starter/I">
            <default value="0"/>
            <test logic="AND" value="6.1">
                systems/starter/sw-push-rele-deleyed-on == 1
            </test>
        </switch>
        
    </channel>
    
    
</system>
