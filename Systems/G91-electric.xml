<?xml version="1.0"?>

<!--
Description: G91R4 Electric system from "Manuale di pilotaggio (p.56)
-->

<system name="electric-system">
    
    <property value="24">systems/electric/bus[0]/battery-nominal-voltage</property>
    <property value="34">systems/electric/bus[0]/battery-AH</property>
    <property value="2937600">systems/electric/bus[0]/battery-capacity-initial-J</property>
    <property value="2937600">systems/electric/bus[0]/battery-capacity-max-J</property>
    <property value="0">systems/electric/bus-link/relay-bus0-bus1-battery</property>
    <property value="0">systems/electric/bus-link/relay-bus1-bus2-secondary</property>
    <property value="0.0">systems/electric/bus[2]/I</property>
    <property value="0">systems/electric/bus[1]/external-power-generator-on</property>
    <property value="1">systems/electric/bus[0]/fire-warning/fuse</property>
    <property value="0">systems/electric/bus[0]/fire-warning/sw</property>
    <property value="1">systems/electric/bus[0]/emergency-canopy-light/fuse</property>
    <property value="0">systems/electric/bus[0]/emergency-canopy-light/sw</property>
    <property value="0.0">systems/electric/bus[0]/emergency-canopy-light/I</property>
    <property value="1">systems/electric/bus[0]/emergency-stabilizer-corrector/fuse</property>
    <property value="1">systems/electric/bus[0]/emergency-radio/fuse</property>
    <property value="0">systems/electric/bus[0]/emergency-radio/sw</property>
    <property value="0.0">systems/electric/bus[0]/emergency-radio/I</property>
    <property value="1">systems/electric/bus[0]/emergency-release-of-external-loads/fuse</property>
    <property value="1">systems/electric/bus[0]/emergency-release-of-external-loads-SALVO/fuse</property>
    <property value="1">systems/electric/bus[1]/JATO-ignition/fuse</property>
    <property value="0">systems/electric/bus[1]/JATO-ignition/sw</property>
    <property value="0.0">systems/electric/bus[1]/JATO-ignition/I</property>
    <property value="1">systems/electric/bus[1]/lower-weapons/fuse</property>
    <property value="1">systems/electric/bus[1]/upper-weapons/fuse</property>
    <property value="1">systems/electric/bus[1]/turbojet-start-up/fuse</property>
    <property value="0">systems/electric/bus[1]/turbojet-start-up/sw</property>
    <property value="1">systems/electric/bus[1]/normal-bombs/fuse</property>
    <property value="1">systems/electric/bus[1]/special-bombs/fuse</property>
    <property value="1">systems/electric/bus[1]/BP-fuel/fuse</property>
    <property value="1">systems/electric/bus[1]/BP-oil/fuse</property>
    <property value="1">systems/electric/bus[1]/landig-gear-command/fuse</property>
    <property value="1">systems/electric/bus[1]/LADD-command/fuse</property>
    <property value="1">systems/electric/bus[1]/canopy-command/fuse</property>
    <property value="1">systems/electric/bus[1]/air-conditioning-pressurization/fuse</property>
    <property value="1">systems/electric/bus[1]/horizontal-stabilization-corrector/fuse</property>
    <property value="1">systems/electric/bus[1]/vertical-tail-corrector/fuse</property>
    <property value="1">systems/electric/bus[1]/fuel-pump/fuse</property>
    <property value="1">systems/electric/bus[1]/fuel-AP-emergency/fuse</property>
    <property value="1">systems/electric/bus[1]/aileron-servocontrol-emergency/fuse</property>
    <property value="1">systems/electric/bus[1]/landing-light/fuse</property>
    <property value="1">systems/electric/bus[1]/aerodynamic-brakes/fuse</property>
    <property value="0">systems/electric/bus[1]/aerodynamic-brakes/sw</property>
    <property value="1">systems/electric/bus[1]/gyrocompass/fuse</property>
    <property value="1">systems/electric/bus[1]/gyrocompass/sw</property>
    <property value="0.0">systems/electric/bus[1]/gyrocompass/I</property>
    <property value="1">systems/electric/bus[1]/IFF/fuse</property>
    <property value="1">systems/electric/bus[1]/IFF/sw</property>
    <property value="0.0">systems/electric/bus[1]/IFF/I</property>
    <property value="1">systems/electric/bus[1]/collimator-lighting/fuse</property>
    <property value="0">systems/electric/bus[1]/collimator-lighting/sw</property>
    <property value="1">systems/electric/bus[1]/hydraulic-system-flight-controls/fuse</property>
    <property value="1">systems/electric/bus[1]/hydraulic-system-general-utilities/fuse</property>
    <property value="1">systems/electric/bus[1]/fuel-level-indicator/fuse</property>
    <property value="0">systems/electric/bus[1]/fuel-level-indicator/sw</property>
    <property value="1">systems/electric/bus[1]/fuel-interception-BP/fuse</property>
    <property value="1">systems/electric/bus[1]/secondary-inverter/fuse</property>
    <property value="0">systems/electric/bus[1]/secondary-inverter/sw</property>
    <property value="1">systems/electric/bus[1]/wing-flap/fuse</property>
    <property value="0">systems/electric/bus[1]/wing-flap/sw</property>
    <property value="0.0">systems/electric/bus[1]/wing-flap/I</property>
    <property value="1">systems/electric/bus[1]/electric-limiter-tamper-jet/fuse</property>
    <property value="1">systems/electric/bus[1]/anti-collision-light/fuse</property>
    <property value="0">systems/electric/bus[1]/anti-collision-light/sw</property>
    <property value="0.0">systems/electric/bus[1]/anti-collision-light/I</property>
    <property value="1">systems/electric/bus[1]/interior-lights/fuse</property>
    <property value="0">systems/electric/bus[1]/interior-lights/sw</property>
    <property value="0.0">systems/electric/bus[1]/interior-lights/I</property>
    <property value="1">systems/electric/bus[1]/additional-tank-pressurization/fuse</property>
    <property value="1">systems/electric/bus[1]/radiogoniometer/fuse</property>
    <property value="0">systems/electric/bus[1]/radiogoniometer/sw</property>
    <property value="0.0">systems/electric/bus[1]/radiogoniometer/I</property>
    <property value="1">systems/electric/bus[1]/UHF-radio/fuse</property>
    <property value="0">systems/electric/bus[1]/UHF-radio/sw</property>
    <property value="0.0">systems/electric/bus[1]/UHF-radio/I</property>
    <property value="1">systems/electric/bus[1]/UHF-radio-emergency/fuse</property>
    <property value="0">systems/electric/bus[1]/UHF-radio-emergency/sw</property>
    <property value="0.0">systems/electric/bus[1]/UHF-radio-emergency/I</property>
    <property value="1">systems/electric/bus[1]/rockets-on-stations/fuse</property>
    <property value="1">systems/electric/bus[1]/rockets-on-rafters/fuse</property>
    <property value="1">systems/electric/bus[1]/pitot-heating/fuse</property>
    <property value="0">systems/electric/bus[1]/pitot-heating/sw</property>
    <property value="0.0">systems/electric/bus[1]/pitot-heating/I</property>
    <property value="1">systems/electric/bus[1]/JATO-plate-release/fuse</property>
    <property value="0">systems/electric/bus[1]/JATO-plate-release/sw</property>
    <property value="1">systems/electric/bus[1]/safe-landing-geta-on-ground/fuse</property>
    <property value="1">systems/electric/bus[1]/safe-special-bombs/fuse</property>
    <property value="1">systems/electric/bus[1]/shoot-on-ground/fuse</property>
    <property value="1">systems/electric/bus[1]/turn-indicator/fuse</property>
    <property value="1">systems/electric/bus[2]/featuring-gun/fuse</property>
    <property value="1">systems/electric/bus[2]/doppler/fuse</property>
    <property value="0">systems/electric/bus[2]/doppler/sw</property>
    <property value="0.0">systems/electric/bus[2]/doppler/I</property>
    <property value="1">systems/electric/bus[2]/inverter-missiles/fuse</property>
    <property value="1">systems/electric/bus[2]/primary-inverter/fuse</property>
    <property value="0">systems/electric/bus[2]/primary-inverter/sw</property>
    <property value="1">systems/electric/bus[2]/position-lights/fuse</property>
    <property value="0">systems/electric/bus[2]/position-lights/sw</property>
    <property value="0.0">systems/electric/bus[2]/position-lights/I</property>
    <property value="1">systems/electric/bus[2]/cockpit-lights/fuse</property>
    <property value="0">systems/electric/bus[2]/cockpit-lights/sw</property>
    <property value="0.0">systems/electric/bus[2]/cockpit-lights/I</property>
    <property value="1">systems/electric/bus[2]/cameras/fuse</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[1]/sw</property>
    <property value="0.0">systems/electric/bus[2]/cameras/camera[1]/I</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[1]/film</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[2]/sw</property>
    <property value="0.0">systems/electric/bus[2]/cameras/camera[2]/I</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[2]/film</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[3]/sw</property>
    <property value="0.0">systems/electric/bus[2]/cameras/camera[3]/I</property>
    <property value="0">systems/electric/bus[2]/cameras/camera[3]/film</property>
    <property value="1">systems/electric/bus[2]/as20-missiles/fuse</property>
    <property value="1">systems/electric/bus[2]/PHI/fuse</property>
    <property value="1">systems/electric/bus[2]/PHI/sw</property>
    <property value="0.0">systems/electric/bus[2]/PHI/I</property>
    <property value="1">systems/electric/bus[2]/generator-emergency-relay/fuse</property>
    <property value="0">systems/electric/bus[2]/generator-emergency-relay/sw</property>
    <property value="1">systems/electric/bus[2]/magnetic-tape/fuse</property>
    <property value="1">systems/electric/bus[2]/magnetic-tape/sw</property>
    <property value="0.0">systems/electric/bus[2]/magnetic-tape/I</property>
    <property value="1">systems/electric/bus[2]/overheating-cameras/fuse</property>
    <property value="1">systems/electric/bus[2]/overheating-guns/fuse</property>
    <property value="1">systems/electric/bus[2]/servo-horizontal-rudder/fuse</property>
    <property value="1">systems/electric/bus[2]/pitch-damper/fuse</property>
    <property value="1">systems/electric/bus[2]/yaw-damper/fuse</property>
    <property value="1">systems/electric/bus[2]/aileron-vibrator/fuse</property>
    <property value="1">systems/electric/bus[2]/cockpit-vibrator/fuse</property>

    
    <channel name="Bus Battery" execrate="8">
        
        <!-- this switch is only for test -->
        <switch name="systems/electric/bus[0]/battery-load-J">
            <default value="0"/>
            <test logic="AND" value="0">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/V GT systems/electric/bus[0]/battery-V
                systems/electric/bus[0]/battery-capacity-J GE systems/electric/bus[0]/battery-capacity-max-J
            </test>
            <test logic="AND" value="50">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/V GT systems/electric/bus[0]/battery-V
            </test>
            <test logic="AND" value="-100">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/V LE systems/electric/bus[0]/battery-V
            </test>
            <test logic="AND" value="-10">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 0
            </test>
        </switch>
        
        <integrator name="systems/electric/bus[0]/battery-energy-change-J">
            <input>systems/electric/bus[0]/battery-load-J</input>
            <c1>1.0</c1>
        </integrator>
        
        <summer name="systems/electric/bus[0]/battery-capacity-J">
            <input>systems/electric/bus[0]/battery-capacity-initial-J</input>
            <input>systems/electric/bus[0]/battery-energy-change-J</input>
        </summer>

        <scheduled_gain name="systems/electric/bus[0]/battery-V">
            <input>systems/electric/bus[0]/battery-nominal-voltage</input>
            <table>
                <independentVar lookup="row">systems/electric/bus[0]/battery-capacity-J</independentVar>
                <tableData>
                    0       0.0
                    1000000 0.8
                    2000000 0.9
                    3000000 1.1
                </tableData>
            </table>
        </scheduled_gain>
        
        <switch name="systems/electric/bus[0]/V">
            <default value="systems/electric/bus[0]/battery-V"/>
            <test logic="AND" value="systems/electric/bus[1]/V">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/V GT systems/electric/bus[0]/battery-V
            </test>  
        </switch>

        <summer name="systems/electric/bus[0]/I">
            <input>systems/electric/bus[0]/emergency-canopy-light/I</input>
            <input>systems/electric/bus[0]/emergency-radio/I</input>
        </summer>
        
    </channel>
    
    
    <channel name="Bus Primary" execrate="8">
        
        <switch name="systems/electric/bus[1]/V">
            <default value="0"/>
            <test logic="AND" value="28">
                systems/electric/bus[1]/external-power-generator-on == 1
            </test>
            <test logic="AND" value="0">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 0
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 0
            </test>  
            <test logic="AND" value="systems/electric/bus[0]/battery-V">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 0
            </test>
            <test logic="AND" value="systems/electric/bus[1]/internal-power-generator-V">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 0
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 1
            </test>
            <test logic="AND" value="systems/electric/bus[1]/internal-power-generator-V">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 1
            </test> 
        </switch>
        
        <switch name="systems/electric/bus[1]/internal-power-generator-V-n1-on">
            <default value="0"/>
            <test logic="AND" value="systems/electric/bus[1]/internal-power-generator-V-n1">
                systems/manual-switches/cockpit/sw-internal-power-generator == 1
            </test>
        </switch>
        
        <lag_filter name="systems/electric/bus[1]/internal-power-generator-V">
            <input>systems/electric/bus[1]/internal-power-generator-V-n1-on</input>
            <c1>10.0</c1>
        </lag_filter>

        <switch name="systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on">
            <default value="0"/>
            <test logic="AND" value="0">
                systems/electric/bus[1]/internal-power-generator-V LT 18
            </test>
            <test logic="AND" value="1">
                systems/manual-switches/cockpit/sw-internal-power-generator == 1
                systems/electric/bus[1]/internal-power-generator-V GE 18
                <test logic="OR">
                    <test logic="AND">
                        systems/manual-switches/cockpit/sw-bus0-bus1-battery == 0
                    </test>
                    <test logic="AND">
                        systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
                        systems/electric/bus[1]/internal-power-generator-V GT systems/electric/bus[0]/battery-V
                    </test>
                </test>
            </test>
        </switch>
        
        <switch name="systems/electric/bus[1]/internal-power-generator-I">
            <default value="0"/>
            <test logic="AND" value="systems/electric/bus[1]/internal-power-generator-I-conditional">
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 1
            </test>
        </switch>
        
        <summer name="systems/electric/bus[1]/internal-power-generator-I-conditional">
            <input>systems/electric/bus[1]/I-bus0-to-bus1</input>
            <input>systems/electric/bus[1]/I</input>
            <input>systems/electric/bus[2]/I</input>
            <input>systems/electric/bus[1]/canopy-command/I</input>
        </summer>
        
        <switch name="systems/electric/bus[1]/I-bus0-to-bus1">
            <default value="0"/>
            <test logic="AND" value="systems/electric/bus[0]/I">
                systems/manual-switches/cockpit/sw-bus0-bus1-battery == 1
            </test>
        </switch>
        
        <switch name="systems/electric/bus-link/relay-bus1-bus2-secondary">
            <default value="0"/>
            <test logic="AND" value="1">
                systems/electric/bus[1]/internal-power-generator-inverted-current-rele-on == 1
            </test>
        </switch>
        
        <summer name="systems/electric/bus[1]/I">
            <input>systems/electric/bus[1]/JATO-ignition/I</input>
            <input>systems/electric/bus[1]/landing-light/I</input>
            <input>systems/electric/bus[1]/gyrocompass/I</input>
            <input>systems/electric/bus[1]/IFF/I</input>
            <input>systems/electric/bus[1]/wing-flap/I</input>
            <input>systems/electric/bus[1]/anti-collision-light/I</input>
            <input>systems/electric/bus[1]/interior-lights/I</input>
            <input>systems/electric/bus[1]/radiogoniometer/I</input>
            <input>systems/electric/bus[1]/UHF-radio/I</input>
            <input>systems/electric/bus[1]/UHF-radio-emergency/I</input>
            <input>systems/electric/bus[1]/pitot-heating/I</input>
            <input>systems/electric/bus[1]/turn-indicator/I</input>
            <input>systems/electric/bus[1]/attitude-indicator/I</input>
            <input>systems/electric/bus[1]/beacon/I</input>
        </summer>
        
    </channel>

    
    <channel name="Bus Secondary" execrate="8">
        
        <switch name="systems/electric/bus[2]/V">
            <default value="0"/>
            <test logic="AND" value="systems/electric/bus[1]/V">
                systems/electric/bus-link/relay-bus1-bus2-secondary == 1
            </test>
        </switch>
        
        <summer name="systems/electric/bus[2]/I">
            <input>systems/electric/bus[2]/doppler/I</input>
            <input>systems/electric/bus[2]/position-lights/I</input>
            <input>systems/electric/bus[2]/cockpit-lights/I</input>
            <input>systems/electric/bus[2]/cameras/camera[1]/I</input>
            <input>systems/electric/bus[2]/cameras/camera[2]/I</input>
            <input>systems/electric/bus[2]/cameras/camera[3]/I</input>
            <input>systems/electric/bus[2]/PHI/I</input>
            <input>systems/electric/bus[2]/magnetic-tape/I</input>
        </summer>
    </channel>
    
    
    <function name="systems/electric/bus[1]/internal-power-generator-V-n1">
        <table>
            <independentVar>propulsion/engine/n1</independentVar>
            <tableData>
                0.0   0.0
                10.0  12.0
                20.0  18.0
                35.0  28.0
                100.0 30.0
            </tableData>
        </table>
    </function>
    
</system>

