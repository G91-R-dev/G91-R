<!-- G91 Brake Control System -->

<!-- 
Original work Copyright (c) 2019 Joshua Davidson (it0uchpods)
    Create the program to centralization of the braking system
Modified work Copyright 2019 Adriano Bassignana (abassign)
    Modify the program forfcs/left/right-steer-brake-intensity
    for keyboard integration ( , and . )
-->

<system name="G91 BCS">
    
    <property value="0.0">fcs/left-steer-brake-intensity</property>
    <property value="0.0">fcs/right-steer-brake-intensity</property>
    
    <channel name="Parking Brake" execrate="16">
        
        <scheduled_gain name="fcs/park-brake-cmd">
            <input>systems/handle-switches/sw-handle-brake-extension</input>
            <table>
                <independentVar lookup="row">systems/hydraulics/flight-system-psi</independentVar>
                <tableData>
                    300  0.0
                    1800  1.0
                </tableData>
            </table>
        </scheduled_gain>
        
    </channel>
    
    
    <channel name="Steering Brake regulator" execrate="4">
        
        <lag_filter name="fcs/left-steer-brake-intensity-lg">
            <input>fcs/left-steer-brake</input>
            <c1>0.5</c1>
        </lag_filter>

        <scheduled_gain name="fcs/left-steer-brake-intensity">
            <input>fcs/left-steer-brake-intensity-lg</input>
            <table>
                <independentVar lookup="row">fcs/left-steer-brake</independentVar>
                <tableData>
                    0.1  0.0
                    0.9  0.3
                    1.0  0.7
                </tableData>
            </table>
        </scheduled_gain>
        
        <lag_filter name="fcs/right-steer-brake-intensity-lg">
            <input>fcs/right-steer-brake</input>
            <c1>0.5</c1>
        </lag_filter>
        
        <scheduled_gain name="fcs/right-steer-brake-intensity">
            <input>fcs/right-steer-brake-intensity-lg</input>
            <table>
                <independentVar lookup="row">fcs/right-steer-brake</independentVar>
                <tableData>
                    0.1  0.0
                    0.9  0.3
                    1.0  0.7
                </tableData>
            </table>
        </scheduled_gain>

    </channel>
    
    
    <channel name="Brakes" execrate="16">
        
        <summer name="fcs/left-brake-summer">
            <input>/controls/gear/brake-left</input>
            <input>fcs/left-steer-brake-intensity</input> <!-- Steering brake command -->
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </summer>
        
        <scheduled_gain name="fcs/left-brake-cmd">
            <input>fcs/left-brake-summer</input>
            <table>
                <independentVar lookup="row">systems/hydraulics/flight-system-psi</independentVar>
                <tableData>
                    300  0.0
                    1800  1.0
                </tableData>
            </table>
        </scheduled_gain>
        
        <summer name="fcs/left-brake-output"> <!-- Output to JSB -->
            <input>fcs/left-brake-cmd</input>
            <input>fcs/park-brake-cmd</input>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
            <output>fcs/left-brake-cmd-norm</output>
        </summer>
        
        <summer name="fcs/right-brake-summer">
            <input>/controls/gear/brake-right</input>
            <input>fcs/right-steer-brake-intensity</input> <!-- Steering brake command -->
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </summer>
        
        <scheduled_gain name="fcs/right-brake-cmd">
            <input>fcs/right-brake-summer</input>
            <table>
                <independentVar lookup="row">systems/hydraulics/flight-system-psi</independentVar>
                <tableData>
                    300  0.0
                    1800  1.0
                </tableData>
            </table>
        </scheduled_gain>
        
        <summer name="fcs/right-brake-output"> <!-- Output to JSB -->
            <input>fcs/right-brake-cmd</input>
            <input>fcs/park-brake-cmd</input>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
            <output>fcs/right-brake-cmd-norm</output>
        </summer>
        
    </channel>
    
</system>
